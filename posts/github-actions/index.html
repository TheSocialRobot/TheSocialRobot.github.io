<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Building NAO applications with GitHub Actions" /><meta property="og:locale" content="en" /><meta name="description" content="Continuous Integration (CI) in the practice of automatically building and testing software every time a change is made. In the last decade I don’t think I’ve worked on a single professional project that didn’t have a Continuous Integration system set up. Why?" /><meta property="og:description" content="Continuous Integration (CI) in the practice of automatically building and testing software every time a change is made. In the last decade I don’t think I’ve worked on a single professional project that didn’t have a Continuous Integration system set up. Why?" /><link rel="canonical" href="https://www.thesocialrobot.org/posts/github-actions/" /><meta property="og:url" content="https://www.thesocialrobot.org/posts/github-actions/" /><meta property="og:site_name" content="The Social Robot" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-01T12:11:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Building NAO applications with GitHub Actions" /><meta name="twitter:site" content="@davesnowdon" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-01T12:11:00+01:00","datePublished":"2022-08-01T12:11:00+01:00","description":"Continuous Integration (CI) in the practice of automatically building and testing software every time a change is made. In the last decade I don’t think I’ve worked on a single professional project that didn’t have a Continuous Integration system set up. Why?","headline":"Building NAO applications with GitHub Actions","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.thesocialrobot.org/posts/github-actions/"},"url":"https://www.thesocialrobot.org/posts/github-actions/"}</script><title>Building NAO applications with GitHub Actions | The Social Robot</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="The Social Robot"><meta name="application-name" content="The Social Robot"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">The Social Robot</a></div><div class="site-subtitle font-italic">An embodied robot companion</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/TheSocialRobot" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/davesnowdon" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hello','thesocialrobot.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Building NAO applications with GitHub Actions</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Building NAO applications with GitHub Actions</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/davesnowdon">Dave Snowdon</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1659352260" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-01 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1882 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>Continuous Integration (CI) in the practice of automatically building and testing software every time a change is made. In the last decade I don’t think I’ve worked on a single professional project that didn’t have a Continuous Integration system set up. Why?</p><ul><li>Prevents “it builds on my machine”. If the project has a unusual set of requirements or build system then being able to build it in a “clean” environment means that you can be sure that everything needed to build the project is specified.<li>Helps ensure you always have a working product. If something gets broken you know immediately that something needs fixing and you know the change that needs to be fixed. If you’ve ever had to spend hours (or days) working your way through all the changes since a last “known good” build then you’ll understand the value of this!<li>Helps teamwork. When members of a team are working on different features, you want to know as early as possible if their changes are going to conflict.</ul><p>Those advantages apply to open source projects too!</p><p>These days one of the first things I do with a new project is set-up the build system. It’s tempting to get by with just building in your IDE, but for anything except a throwaway project or quick proof of concept, that’s normally a bad idea as you won’t know if your software builds because of a particular setup or installed plugin until someone else tries to build it. If someone can’t build your project easily they’re unlikely to contribute.</p><p>The part of “The Social Robot” that runs on NAO, let’s call it the “body” application, will need to use native (compiled) code for performance. Building native code to run on NAO is a bit painful as it requires a custom toolchain. The easiest way to setup a toolchain to cross-compile for NAO is to use custom Aldebaran software called <a href="https://github.com/aldebaran/qibuild">“qibuild”</a>.</p><p>Setting up a qibuild toolchain is a bit of a faff. We can use docker to provide a build environment that works for anyone. Finally, we’ll use GitHub Actions to automate the build so that every commit to the GitHub repo builds our body application.</p><h2 id="manual-nao-cross-compilation-setup"><span class="mr-2">Manual NAO cross-compilation setup</span><a href="#manual-nao-cross-compilation-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>I’m not going to explain qibuild in much depth, if you’d like to know more you can find the official documentation <a href="http://doc.aldebaran.com/qibuild/beginner/index.html">here</a>. Thankfully, qibuild does not implement a totally custom build system, but is a wrapper around <a href="https://cmake.org/">CMake</a>. qibuild has the concepts of <a href="http://doc.aldebaran.com/qibuild/hacking/design/python/overviews/worktree_and_projects.html#worktree-and-projects">projects and worktrees</a>. Basically, a worktree is a container for projects. A “toolchain” is the configuration and set of libraries needed to build a project for a particular target. As far as NAO is concerned there are two targets: developer workstations and the NAO robot itself. NAO version 4 and later use an <a href="https://en.wikipedia.org/wiki/Intel_Atom">Intel Atom</a> processor which means that although it’s IA-32 it won’t have the same instructions available as a modern desktop (IA-64). Also the libraries installed on NAO are quite old and so likely different versions from a modern Linux distro.</p><p>We need to install qibuild, set up our worktree and project and configure the toolchains in order to build our application.</p><p>Unless, you’re feeling particularly keen, you don’t need to do all these steps - just use the docker image I’ll describe in the next section!</p><h3 id="installing-qibuild"><span class="mr-2">Installing qibuild</span><a href="#installing-qibuild" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>It’s good practice to use python virtual envs to keep requirements for different projects separate. I use <a href="https://github.com/pyenv/pyenv">pyenv</a> to manage my python installations, so I ran the following to create and activate a new virtual env:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>pyenv virtualenv 3.9.6 the-social-robot
pyenv activate the-social-robot
</pre></table></code></div></div><p>or if you prefer the built-in python virtual env:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> python <span class="nt">-m</span> venv the-social-robot
 <span class="nb">source </span>the-social-robot/bin/activate
</pre></table></code></div></div><p>You can then install qibuild using pip:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>python <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip
pip <span class="nb">install </span>qibuild
</pre></table></code></div></div><h3 id="configuring-the-qibuild-worktree-and-project"><span class="mr-2">Configuring the qibuild worktree and project</span><a href="#configuring-the-qibuild-worktree-and-project" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>If you’ve cloned the <a href="https://github.com/TheSocialRobot/NaoBody">repo</a> then you shouldn’t need to do this.</p><p>First create a worktree:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>qibuild init
</pre></table></code></div></div><p>Then create a project called “body” in that worktree:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>qisrc create body
qibuild configure body
qibuild make body
</pre></table></code></div></div><h3 id="setting-up-the-toolchains"><span class="mr-2">Setting up the toolchains</span><a href="#setting-up-the-toolchains" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Now it gets a little annoying as you need to download the NAOqi SDK from the SoftBank Robotics downloads page: <a href="https://www.softbankrobotics.com/emea/en/support/nao-6/downloads-softwares/">https://www.softbankrobotics.com/emea/en/support/nao-6/downloads-softwares/</a>. Note that the latest NAOqi release only works on the latest NAO (v6). I have a NAO v4 (actually a v3 body with a v4 head) and a NAO v5 which means the latest version of NAOqi I can install on the robots is 2.1.4.13. Once you’ve downloaded the SDK and the cross-compilation SDK you need to tell qibuild about them.</p><p>For desktop:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>qitoolchain create naoqi-sdk /path/to/cpp/sdk/toolchain.xml
qibuild add-config naoqi-sdk <span class="nt">--toolchain</span> naoqi-sdk
</pre></table></code></div></div><p>For robot:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>qitoolchain create cross-atom /path/to/ctc/toolchain.xml
qibuild add-config cross-atom <span class="nt">--toolchain</span> cross-atom
</pre></table></code></div></div><p>You should then be able to build the “hello world” app created by <code class="language-plaintext highlighter-rouge">qisrc</code></p><p>For desktop:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>qibuild configure <span class="nt">-c</span> naoqi-sdk body
qibuild make <span class="nt">-c</span> naoqi-sdk body
</pre></table></code></div></div><p>For robot:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>qibuild configure <span class="nt">-c</span> cross-atom body
qibuild make <span class="nt">-c</span> cross-atom body
</pre></table></code></div></div><p>I’m not sure if <code class="language-plaintext highlighter-rouge">qibuild configure</code> is required every time you change toolchain or just on first setup.</p><h2 id="building-nao-applications-in-a-docker-container"><span class="mr-2">Building NAO applications in a docker container</span><a href="#building-nao-applications-in-a-docker-container" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Luckily, you don’t have to do all the above steps! docker containers provide isolated and predictable environments to run software in so let’s take advantage of that to build a container image so we never have to setup qibuild again!</p><p>I’m going to assume you know how to build and run docker containers. If not, take a look at the <a href="https://docs.docker.com/get-started/">getting started docs</a>.</p><p>TL;DR</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker pull thesocialrobot/naobuild:main
</pre></table></code></div></div><p>Here’s the Dockerfile that automates the steps from the last section:</p><div class="language-docker highlighter-rouge"><div class="code-header"> <span data-label-text="Docker"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="c"># syntax=docker/dockerfile:1</span>
<span class="k">FROM</span><span class="s"> python:3.9.6-slim-buster</span>

<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\
</span>    build-essential <span class="se">\
</span>    ca-certificates <span class="se">\
</span>    cmake <span class="se">\
</span>    curl <span class="se">\
</span>    software-properties-common <span class="se">\
</span>    unzip <span class="se">\
</span>    wget <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="k">RUN </span>python <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip

<span class="k">RUN </span>pip <span class="nb">install </span>qibuild 

<span class="c"># don't want to run as root</span>
<span class="k">RUN </span>useradd <span class="nt">-rm</span> <span class="nt">-d</span> /app <span class="nt">-s</span> /bin/bash <span class="nt">-u</span> 1001 builduser
<span class="k">RUN </span><span class="nb">mkdir</span> /opt/toolchains
<span class="k">RUN </span><span class="nb">chown</span> <span class="nt">-R</span> builduser /opt/toolchains
<span class="k">USER</span><span class="s"> builduser</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># fix path so qibuild is available later</span>
<span class="k">ENV</span><span class="s"> PATH "$PATH:/usr/local/bin"</span>
<span class="k">RUN </span><span class="nb">echo</span> <span class="s2">"export PATH=</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span><span class="s2">:/usr/local/bin"</span> <span class="o">&gt;&gt;</span> /app/.bashrc

<span class="c"># NAOQI SDKs</span>
<span class="k">WORKDIR</span><span class="s"> /opt/toolchains</span>
<span class="k">RUN </span>wget <span class="nt">-q</span> https://the-social-robot.s3.eu-west-2.amazonaws.com/nao-2.1.4.13/naoqi-sdk-2.1.4.13-linux64.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">tar</span> <span class="nt">-xf</span> naoqi-sdk-2.1.4.13-linux64.tar.gz
<span class="k">RUN </span>wget <span class="nt">-q</span> https://the-social-robot.s3.eu-west-2.amazonaws.com/nao-2.1.4.13/ctc-linux64-atom-2.1.4.13.zip <span class="o">&amp;&amp;</span> <span class="se">\
</span>    unzip <span class="nt">-q</span> ctc-linux64-atom-2.1.4.13.zip

<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="c"># qibuild setup</span>
<span class="k">RUN </span>qibuild init

<span class="c"># desktop toolchain</span>
<span class="k">RUN </span>qitoolchain create naoqi-sdk /opt/toolchains/naoqi-sdk-2.1.4.13-linux64/toolchain.xml
<span class="k">RUN </span>qibuild add-config naoqi-sdk <span class="nt">--toolchain</span> naoqi-sdk

<span class="c"># robot (cross-compilation) toolchain</span>
<span class="k">RUN </span>qitoolchain create cross-atom /opt/toolchains/ctc-linux64-atom-2.1.4.13/toolchain.xml
<span class="k">RUN </span>qibuild add-config cross-atom <span class="nt">--toolchain</span> cross-atom

<span class="c"># place to checkout code in and build</span>
<span class="k">RUN </span><span class="nb">mkdir</span> /app/build
<span class="k">WORKDIR</span><span class="s"> /app/build</span>
</pre></table></code></div></div><p>Given the recent turmoil about Softbank Robotics Europe / Aldebaran I wasn’t sure whether I could count on the downloads page being available long-term so I’m downloading the toolchain binaries from an S3 bucket for now.</p><p>qibuild stores its configuration in the per-user <code class="language-plaintext highlighter-rouge">~/.config/qi</code> directory so when using the docker container we need to run our build as <code class="language-plaintext highlighter-rouge">builduser</code> as configured above.</p><p>GitHub Actions defaults to running docker containers as user ID 1001 so in order to avoid permissions issues, I’ve used 1001 as the ID for <code class="language-plaintext highlighter-rouge">builduser</code>.</p><p>You can find the complete Dockerfile in the <a href="https://github.com/TheSocialRobot/NaoBuild/">NAO build repo</a> and the pre-built images on <a href="https://hub.docker.com/repository/docker/thesocialrobot/naobuild">docker hub</a>.</p><h2 id="using-github-actions-to-automatically-build-the-application"><span class="mr-2">Using GitHub Actions to automatically build the application</span><a href="#using-github-actions-to-automatically-build-the-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now we have a docker container we can use for repeatable builds we can setup a Continuous Integration system. There are several systems that are free for open source projects, but I’m going to use <a href="https://docs.github.com/en/actions">GitHub Actions</a> since it’s built-in to GitHub.</p><p>We need two build pipelines:</p><ul><li>one to build the docker container image and push it to dockerhub<li>another one to build the application in the docker container</ul><p>I could configure GitHub actions to do everything in a single build pipeline, but it’s convenient to have the docker container separated out so I can use it locally on my machine and for other NAO projects. It’s also going to be faster than having to run the full qibuild configure process every time.</p><h3 id="building-the-docker-image"><span class="mr-2">Building the docker image</span><a href="#building-the-docker-image" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>GitHub Actions looks for build workflows in the <code class="language-plaintext highlighter-rouge">.github/workflows</code> directory at the top-level of a repo. Workflows are written in <a href="https://yaml.org/">YAML</a> format. You can find the complete workflow for this [here]https://github.com/TheSocialRobot/NaoBuild/blob/main/.github/workflows/docker-image.yml). In order to make the image easily available I want to push it to dockerhub. The steps are configure the workflow, checkout the code, setup the docker build environment, login to dockerhub and finally build and push the image. Docker provides actions to make this very easy indeed.</p><p>Setup the workflow to run a sequence of actions on a Ubuntu worker on every push to main:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Build build image</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">main'</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">docker</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
</pre></table></code></div></div><p>Checkout the code:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
</pre></table></code></div></div><p>Setup the docker build environment:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Docker Buildx</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/setup-buildx-action@v2</span>
</pre></table></code></div></div><p>Login to dockerhub. I don’t want to expose my dockerhub credentials to the world so they are configures as secrets on the repo:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to DockerHub</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">username</span><span class="pi">:</span>  <span class="s">${{ secrets.DOCKERHUB_USERNAME }}</span> 
          <span class="na">password</span><span class="pi">:</span>  <span class="s">${{ secrets.DOCKERHUB_TOKEN }}</span> 
</pre></table></code></div></div><p>Build and push the image:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/build-push-action@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">push</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">tags</span><span class="pi">:</span>   <span class="s">${{ steps.meta.outputs.tags }}</span> 
          <span class="na">labels</span><span class="pi">:</span>  <span class="s">${{ steps.meta.outputs.labels }}</span> 
</pre></table></code></div></div><p>There’s also another step to set the tags used for the image which I’ve omitted above as I still need to get it working with semantic versioning.</p><p>Looking on the “Actions” tab of the “NaoBuild” repo and clicking on a particular run, you can see that each step succeeded:</p><p><img data-src="/assets/posts/2022-08-01-github-actions/docker-build-success.png" alt="Body building" data-proofer-ignore></p><p>If you get something wrong, or a workflow step fails then GitHub shows you exactly where the failure is:</p><p><img data-src="/assets/posts/2022-08-01-github-actions/docker-build-failed.png" alt="Body building" data-proofer-ignore></p><p>You can click on any step to see more information including the output of the command(s) run.</p><h3 id="building-the-application"><span class="mr-2">Building the application</span><a href="#building-the-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>There isn’t an equivalent place to dockerhub for random binaries (I suppose I could upload them to S3) so I’ve opted, for now, to make the build output available as artifacts of the build, so they can be easily downloaded. As for the docker image I need to checkout the code and then the steps to build the application and save the output are pretty much identical for the 2 toolchains. I’ve created simple scripts <code class="language-plaintext highlighter-rouge">make-desktop.sh</code> and <code class="language-plaintext highlighter-rouge">make-robot.sh</code> so I don’t have to remember the qibuild commands when running manually so all the action needs to do is run those scripts and save the output.</p><p>Build a configuration:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build desktop</span>
      <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">./make-desktop.sh</span>
</pre></table></code></div></div><p>Save the output:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Archive desktop build output</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-artifact@v3</span>
      <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">desktop-binaries</span>
          <span class="na">path</span><span class="pi">:</span>  <span class="s">${{ format('{0}/{1}', github.workspace, "body/build-naoqi-sdk/sdk/bin") }}</span> 
</pre></table></code></div></div><p>You can see the artifacts available for download for each GitHub Actions run on the “Actions” tab of the repo.</p><p><img data-src="/assets/posts/2022-08-01-github-actions/body-build.png" alt="Body building" data-proofer-ignore></p><p>You can find the complete workflow to build the application <a href="https://github.com/TheSocialRobot/NaoBody/blob/main/.github/workflows/body.yml">here</a>.</p><h2 id="next-steps"><span class="mr-2">Next steps</span><a href="#next-steps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The next post will be non-technical and will cover <a href="https://www.kuki.ai/">kuki.ai</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> All rights reserved by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Building NAO applications with GitHub Actions - The Social Robot&amp;url=https://www.thesocialrobot.org//posts/github-actions/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Building NAO applications with GitHub Actions - The Social Robot&amp;u=https://www.thesocialrobot.org//posts/github-actions/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://www.thesocialrobot.org//posts/github-actions/&amp;text=Building NAO applications with GitHub Actions - The Social Robot" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/bridging-the-digital-divide-can-humans-and-ais-forge-true-friendships/">Bridging the Digital Divide: Can Humans and AIs Forge True Friendships?</a><li><a href="/posts/chatgpt/">State of the Chatbot - ChatGPT</a><li><a href="/posts/basic-architecture/">Basic Architecture</a><li><a href="/posts/hello-world/">Hello World</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/i-ve-been-doing-the-social-robot-wrong/"><div class="card-body"> <em class="timeago small" data-ts="1729448520" > 2024-10-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>I've been doing the social robot wrong</h3><div class="text-muted small"><p> I’ve been thinking about my lack of progress on The Social Robot project. It occurs to me that it’s been at a standstill because I’ve been finding it very hard to motivate myself. I think that’s be...</p></div></div></a></div><div class="card"> <a href="/posts/empowering-the-bedridden-robots-enable-work-and-social-engagement-from-home/"><div class="card-body"> <em class="timeago small" data-ts="1694893500" > 2023-09-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Empowering the Bedridden: How Robots Are Changing Lives by Enabling Work and Social Engagement</h3><div class="text-muted small"><p> Introduction Imagine being confined to your home, unable to step outside, yet still having the ability to work and socialize as if you were out in the world. This isn’t a futuristic dream; it’s ...</p></div></div></a></div><div class="card"> <a href="/posts/bridging-the-digital-divide-can-humans-and-ais-forge-true-friendships/"><div class="card-body"> <em class="timeago small" data-ts="1682015820" > 2023-04-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bridging the Digital Divide: Can Humans and AIs Forge True Friendships?</h3><div class="text-muted small"><p> I just finished listening to the Bot Love podcast and that got me wondering: “can it really be possible for a human and AI to be friends?” Asymmetric friendship normally refers to friendships in w...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/woebot/" class="btn btn-outline-primary" prompt="Older"><p>State of the Chatbot - Woebot</p></a> <a href="/posts/kuki/" class="btn btn-outline-primary" prompt="Newer"><p>State of the Chatbot - Kuki</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://www.thesocialrobot.org//posts/github-actions/'; this.page.identifier = '/posts/github-actions/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://thesocialrobot.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/davesnowdon">Dave Snowdon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are copyright of the author and may not be reproduced without permission.">All rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-DSJH283QQW"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-DSJH283QQW'); }); </script>
